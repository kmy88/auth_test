# 개인계정 관리 시스템 설계 문서

## 1. 시스템 개요
UI 자동화 도구에서 계정 정보를 안전하게 관리하고 API를 통해 제공하는 시스템

### 핵심 목표
- 계정 정보의 강력한 암호화 저장
- API 기반 인증키 방식으로 보안 접근 제어
- 사용자 친화적인 관리 UI 제공
- UI 자동화 도구와의 안전한 연동

## 2. 시스템 아키텍처

### 2.1 전체 구조
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   관리자 UI     │    │     API 서버     │    │  UI 자동화 도구  │
│   (Tkinter)     │◄──►│    (FastAPI)    │◄──►│   (클라이언트)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                               │
                       ┌─────────────────┐
                       │  암호화된 DB     │
                       │   (SQLite)      │
                       └─────────────────┘
```

### 2.2 핵심 컴포넌트
1. **암호화 계정 저장소** (SQLite + Fernet 암호화)
2. **API 서버** (FastAPI)
3. **인증 시스템** (API Key 기반)
4. **관리자 UI** (Tkinter)
5. **클라이언트 라이브러리** (requests 기반)

## 3. 데이터베이스 설계

### 3.1 accounts 테이블
```sql
CREATE TABLE accounts (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    alias VARCHAR(50) UNIQUE NOT NULL,
    encrypted_username TEXT NOT NULL,
    encrypted_password TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### 3.2 api_keys 테이블
```sql
CREATE TABLE api_keys (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    key_name VARCHAR(50) UNIQUE NOT NULL,
    api_key VARCHAR(64) UNIQUE NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_used TIMESTAMP
);
```

## 4. API 설계

### 4.1 엔드포인트
```
POST   /auth/validate     - API 키 검증
GET    /accounts/{alias}  - 계정 정보 조회
POST   /accounts          - 계정 정보 저장
PUT    /accounts/{alias}  - 계정 정보 수정
DELETE /accounts/{alias}  - 계정 정보 삭제
GET    /accounts          - 계정 목록 조회 (alias만)
```

### 4.2 요청/응답 예시
```json
# GET /accounts/myservice
Headers: {"X-API-Key": "your-api-key"}
Response: {
    "alias": "myservice",
    "username": "decrypted-username",
    "password": "decrypted-password"
}
```

## 5. 보안 설계

### 5.1 암호화 방식
- **알고리즘**: Fernet (AES 128, CBC mode, PKCS7 padding)
- **키 관리**: 마스터 키는 환경변수 또는 별도 키 파일 관리
- **솔트**: 각 계정별 고유 솔트 적용

### 5.2 API 인증
- **방식**: API Key 기반 인증
- **키 형태**: 64자리 랜덤 생성 문자열
- **전송**: HTTP 헤더 `X-API-Key`
- **만료**: 키별 활성/비활성 상태 관리

### 5.3 보안 고려사항
- 메모리 내 평문 데이터 최소 체류 시간
- 로그에서 민감 정보 제외
- API 요청 제한 (Rate Limiting)
- HTTPS 통신 권장

## 6. 사용자 인터페이스 설계

### 6.1 관리자 UI (Tkinter)
```
┌─────────────────────────────────────┐
│     개인계정 관리 시스템             │
├─────────────────────────────────────┤
│ 계정 목록                           │
│ ┌─────────────────────────────────┐ │
│ │ alias1    │ 수정 │ 삭제        │ │
│ │ alias2    │ 수정 │ 삭제        │ │
│ └─────────────────────────────────┘ │
│                                     │
│ [새 계정 추가]                      │
│                                     │
│ API 키 관리                         │
│ ┌─────────────────────────────────┐ │
│ │ key1      │ 활성 │ 비활성      │ │
│ └─────────────────────────────────┘ │
│ [새 API 키 생성]                    │
└─────────────────────────────────────┘
```

### 6.2 계정 추가/수정 다이얼로그
```
┌─────────────────────────────────────┐
│         계정 정보 입력               │
├─────────────────────────────────────┤
│ Alias:    [myservice           ]   │
│ Username: [user@example.com    ]   │
│ Password: [**************      ]   │
│                                     │
│        [저장]    [취소]             │
└─────────────────────────────────────┘
```

## 7. 파일 구조

```
auth_tool/
├── src/
│   ├── __init__.py
│   ├── models/
│   │   ├── __init__.py
│   │   ├── database.py
│   │   └── account.py
│   ├── services/
│   │   ├── __init__.py
│   │   ├── encryption.py
│   │   ├── auth.py
│   │   └── account_manager.py
│   ├── api/
│   │   ├── __init__.py
│   │   ├── main.py
│   │   ├── routes.py
│   │   └── middleware.py
│   ├── ui/
│   │   ├── __init__.py
│   │   ├── main_window.py
│   │   ├── account_dialog.py
│   │   └── api_key_manager.py
│   └── client/
│       ├── __init__.py
│       └── auth_client.py
├── requirements.txt
├── config.py
├── run_server.py
├── run_ui.py
└── README.md
```

## 8. 기술 스택

### 8.1 백엔드
- **프레임워크**: FastAPI
- **데이터베이스**: SQLite
- **암호화**: cryptography (Fernet)
- **인증**: 커스텀 API Key

### 8.2 프론트엔드
- **GUI**: Tkinter
- **HTTP 클라이언트**: requests

### 8.3 의존성
```txt
fastapi==0.104.1
uvicorn==0.24.0
cryptography==41.0.7
sqlalchemy==2.0.23
pydantic==2.5.0
requests==2.31.0
python-multipart==0.0.6
```

## 9. 사용 시나리오

### 9.1 계정 등록
1. 관리자 UI에서 '새 계정 추가' 클릭
2. Alias, Username, Password 입력
3. 암호화하여 데이터베이스 저장

### 9.2 UI 자동화 도구에서 사용
```python
from auth_client import AuthClient

client = AuthClient("your-api-key")
account = client.get_account("myservice")
# selenium 또는 다른 UI 자동화 도구에서 사용
driver.find_element("username").send_keys(account.username)
driver.find_element("password").send_keys(account.password)
```

## 10. 향후 확장 계획
- 계정 정보 백업/복원 기능
- 2FA 지원
- 웹 기반 관리 인터페이스
- 계정 사용 로그 및 감사
- 다중 사용자 지원

## 11. 보안 체크리스트
- [ ] 마스터 암호화 키 안전한 보관
- [ ] API 키 정기 교체
- [ ] 데이터베이스 파일 접근 권한 제한
- [ ] 로그 파일에서 민감 정보 제거
- [ ] 네트워크 통신 암호화 (HTTPS)
- [ ] 메모리 덤프 시 민감 정보 보호

---
*이 설계 문서는 보안을 최우선으로 하는 개인 계정 관리 시스템의 기본 구조를 제시합니다.*